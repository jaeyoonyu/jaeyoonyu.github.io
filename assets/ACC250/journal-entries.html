<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal Entry Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .page-wrapper {
            display: flex;
            min-height: 100vh;
        }

        .content-wrapper {
            flex: 1;
            margin-left: 200px;
            display: flex;
            justify-content: center;
            background: white;
            min-height: 100vh;
            padding: 20px 30px;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 200px;
            background: #2d3748;
            color: white;
            padding: 15px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar h3 {
            padding: 0 15px;
            margin-bottom: 15px;
            font-size: 1.1em;
            color: white;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        .sidebar .chapter-section {
            margin-bottom: 15px;
        }

        .sidebar .chapter-title {
            font-size: 0.9em;
            font-weight: 600;
            color: rgba(255,255,255,0.9);
            margin-bottom: 8px;
            padding: 0 15px;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar li {
            margin: 0;
        }

        .sidebar a {
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            padding: 10px 15px;
            display: block;
            font-size: 0.9em;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .sidebar a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .sidebar a.active {
            background: rgba(59, 130, 246, 0.3);
            color: white;
            border-left-color: #3b82f6;
            font-weight: 600;
        }

        .sidebar a.correct {
            color: #2ecc71;
        }

        .sidebar a.correct:hover {
            color: #2ecc71;
        }

        .sidebar a.incorrect {
            color: #e74c3c;
        }

        .sidebar a.incorrect:hover {
            color: #e74c3c;
        }

        .container {
            width: 100%;
            max-width: 650px;
            padding: 8px;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
            }
            
            .content-wrapper {
                margin-left: 0;
            }
            
            .sidebar ul {
                display: flex;
                flex-wrap: wrap;
                gap: 4px;
            }
            
            .sidebar li {
                margin-bottom: 0;
            }
        }

        header {
            text-align: center;
            color: #2d3748;
            margin-bottom: 6px;
        }

        header h1 {
            font-size: 1.6em;
            margin-bottom: 8px;
            color: #2d3748;
        }

        header p {
            color: #718096;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        /* Step Navigation */
        .step-nav {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-bottom: 5px;
        }

        .step-btn {
            background: #e2e8f0;
            color: #4a5568;
            border: 2px solid #cbd5e0;
            padding: 5px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .step-btn:hover {
            background: #cbd5e0;
            color: #2d3748;
        }

        .step-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .step-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Progress Bar */
        .progress-container {
            background: #e2e8f0;
            border-radius: 6px;
            height: 4px;
            margin-bottom: 4px;
            overflow: hidden;
        }

        .progress-bar {
            background: #3b82f6;
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-text {
            color: #4a5568;
            text-align: center;
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        /* Main Card */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .card-header {
            background: #f8f9fa;
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
        }

        .question-number {
            color: #1e40af;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
        }

        .transaction-text {
            font-size: 1rem;
            color: #2d3748;
            line-height: 1.3;
        }

        .card-body {
            padding: 12px;
        }

        /* Journal Entry Table */
        .journal-entry {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 8px;
        }

        .journal-entry th {
            background: #3b82f6;
            color: white;
            padding: 5px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .journal-entry th:nth-child(2),
        .journal-entry th:nth-child(3) {
            text-align: right;
            width: 85px;
        }

        .journal-entry td {
            padding: 6px 8px;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        .journal-entry td:nth-child(2),
        .journal-entry td:nth-child(3) {
            text-align: right;
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }

        .journal-entry tr.credit-row td:first-child {
            padding-left: 30px;
        }

        /* Account Slot */
        .account-slot {
            display: inline-block;
            min-width: 140px;
            padding: 4px 8px;
            border: 2px dashed #ccc;
            border-radius: 5px;
            background: #f8f9fa;
            color: #999;
            font-style: italic;
            font-size: 0.9rem;
        }

        .account-slot.filled {
            border-style: solid;
            font-style: normal;
            font-weight: 600;
        }

        .account-slot.debit-filled {
            border-color: #3b82f6;
            background: #dbeafe;
            color: #1e40af;
        }

        .account-slot.credit-filled {
            border-color: #ef4444;
            background: #fee2e2;
            color: #991b1b;
        }

        .account-slot.correct {
            border-color: #10b981;
            background: #d1fae5;
            color: #065f46;
        }

        .account-slot.incorrect {
            border-color: #ef4444;
            background: #fee2e2;
            color: #991b1b;
        }

        .amount {
            color: #2d3748;
        }

        /* Account Selection Panel - Two Columns */
        .account-panel {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 8px;
            margin-bottom: 6px;
        }

        .account-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .account-column {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .column-header {
            text-align: center;
            font-weight: 600;
            padding: 4px;
            border-radius: 5px;
            margin-bottom: 2px;
            font-size: 0.85rem;
        }

        .column-header.debit {
            background: #3b82f6;
            color: white;
        }

        .column-header.credit {
            background: #ef4444;
            color: white;
        }

        .account-btn {
            padding: 5px 8px;
            font-size: 0.85rem;
            border: 2px solid #ddd;
            border-radius: 5px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.15s ease;
            font-weight: 500;
            text-align: center;
        }

        .account-btn:hover {
            border-color: #999;
            background: #f5f5f5;
        }

        .account-btn.focused {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.5);
        }

        .account-btn.debit-selected {
            border-color: #3b82f6;
            background: #3b82f6;
            color: white;
        }

        .account-btn.credit-selected {
            border-color: #ef4444;
            background: #ef4444;
            color: white;
        }

        .account-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Buttons */
        .btn-container {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 6px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 6px 12px;
            font-size: 0.85rem;
            border: 2px solid transparent;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-weight: 600;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn.focused {
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.5);
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-secondary {
            background: #718096;
            color: white;
        }

        .btn-clear {
            background: #ef4444;
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Feedback */
        .feedback {
            margin-top: 8px;
            padding: 10px;
            border-radius: 8px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .feedback.incorrect {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .feedback h3 {
            margin-bottom: 6px;
            font-size: 1.1rem;
        }

        .feedback p {
            line-height: 1.4;
            font-size: 1.05rem;
        }

        /* Score Display */
        .score-display {
            text-align: center;
            color: #2d3748;
            margin-top: 6px;
            font-size: 0.9rem;
        }

        .score-display span {
            font-weight: bold;
            font-size: 1.05rem;
        }

        /* Keyboard hint */
        .keyboard-hint {
            text-align: center;
            color: #718096;
            font-size: 0.75rem;
            margin-top: 6px;
        }

        .keyboard-hint kbd {
            background: #eee;
            padding: 1px 4px;
            border-radius: 3px;
            border: 1px solid #ccc;
            font-family: inherit;
            font-size: 0.75rem;
        }

        .chapter-label {
            text-align: center;
            color: #2d3748;
            font-size: 1rem;
            font-weight: 600;
            margin: 8px 0;
            padding: 6px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
        }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <nav class="sidebar">
            <h3>Questions</h3>
            <div class="chapter-section" id="ch2-section">
                <div class="chapter-title">Chapter 2</div>
                <ul id="ch2-questions"></ul>
            </div>
            <div class="chapter-section" id="ch3-section">
                <div class="chapter-title">Chapter 3</div>
                <ul id="ch3-questions"></ul>
            </div>
        </nav>
        <div class="content-wrapper">
            <div class="container">
        <header>
            <h1>Journal Entry Practice</h1>
            <p>Select accounts for the journal entry</p>
        </header>

        <div class="step-nav">
            <button class="step-btn active" onclick="switchStep(1)">Ch2</button>
            <button class="step-btn" onclick="switchStep(2)">Ch3</button>
        </div>

        <div class="chapter-label" id="chapter-label">Journal entries required in August</div>

        <div class="progress-container">
            <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
        </div>
        <div class="progress-text" id="progress-text">Question 1 of 6</div>

        <div class="card">
            <div class="card-header">
                <div class="question-number" id="question-number">Transaction 1</div>
                <div class="transaction-text" id="transaction-text"></div>
            </div>
            <div class="card-body">
                <table class="journal-entry">
                    <thead>
                        <tr>
                            <th>Account</th>
                            <th>Debit</th>
                            <th>Credit</th>
                        </tr>
                    </thead>
                    <tbody id="journal-body">
                    </tbody>
                </table>

                <div class="account-panel" id="account-panel">
                    <div class="account-columns">
                        <div class="account-column" id="debit-column">
                            <div class="column-header debit">On debit side:</div>
                        </div>
                        <div class="account-column" id="credit-column">
                            <div class="column-header credit">On credit side:</div>
                        </div>
                    </div>
                    <div class="keyboard-hint">
                        <kbd>←</kbd><kbd>→</kbd><kbd>↑</kbd><kbd>↓</kbd> navigate accounts &nbsp;|&nbsp;
                        <kbd>Space</kbd> select &nbsp;|&nbsp;
                        <kbd>Enter</kbd> submit/next &nbsp;|&nbsp;
                        <kbd>Shift+←</kbd> prev &nbsp;|&nbsp;
                        <kbd>Shift+→</kbd> next &nbsp;|&nbsp;
                        <kbd>Esc</kbd> clear
                    </div>
                </div>

                <div class="btn-container" id="btn-container">
                    <button class="btn btn-secondary" id="btn-prev" onclick="prevQuestion()">← Previous</button>
                    <button class="btn btn-clear" id="btn-clear" onclick="clearSelections()">Clear</button>
                    <button class="btn btn-success" id="btn-check" onclick="checkAnswer()">Check Answer</button>
                    <button class="btn btn-secondary" id="btn-next" onclick="nextQuestion()">Next →</button>
                </div>

                <div class="feedback" id="feedback">
                    <h3 id="feedback-title"></h3>
                    <p id="feedback-text"></p>
                </div>
            </div>
        </div>

        <div class="score-display">
            Score: <span id="score">0</span> / <span id="total">6</span>
            </div>
        </div>
    </div>

    <script>
        // Ch2 Accounts
        const ch2Accounts = [
            "Cash", "Supplies", "Software", "PPE (Equipment)",
            "Accounts Payable", "Notes Payable", "Logo and Trademarks", "Common Stock"
        ];

        // Ch2 Transactions
        const ch2Transactions = [
            {
                id: 1,
                text: "The owners invested $50,000 cash to start the business.",
                debitAccount: "Cash",
                creditAccount: "Common Stock",
                debitAmount: 50000,
                creditAmount: 50000,
                explanation: "When owners invest cash, the company receives Cash (an asset that increases with a debit) and issues Common Stock (equity that increases with a credit)."
            },
            {
                id: 2,
                text: "Purchased office supplies for $2,000 on account.",
                debitAccount: "Supplies",
                creditAccount: "Accounts Payable",
                debitAmount: 2000,
                creditAmount: 2000,
                explanation: "Buying supplies on account increases Supplies (asset, debit) and creates an obligation in Accounts Payable (liability, credit)."
            },
            {
                id: 3,
                text: "Purchased equipment for $30,000 cash.",
                debitAccount: "PPE (Equipment)",
                creditAccount: "Cash",
                debitAmount: 30000,
                creditAmount: 30000,
                explanation: "Purchasing equipment increases PPE (asset, debit) and decreases Cash (asset, credit). This is an exchange of one asset for another."
            },
            {
                id: 4,
                text: "Borrowed $20,000 from the bank by signing a note.",
                debitAccount: "Cash",
                creditAccount: "Notes Payable",
                debitAmount: 20000,
                creditAmount: 20000,
                explanation: "Borrowing money increases Cash (asset, debit) and creates a Notes Payable obligation (liability, credit)."
            },
            {
                id: 5,
                text: "Purchased accounting software for $5,000 on account.",
                debitAccount: "Software",
                creditAccount: "Accounts Payable",
                debitAmount: 5000,
                creditAmount: 5000,
                explanation: "Buying software on account increases Software (asset, debit) and creates an Accounts Payable obligation (liability, credit)."
            },
            {
                id: 6,
                text: "Paid $8,000 cash to register the company logo and trademarks.",
                debitAccount: "Logo and Trademarks",
                creditAccount: "Cash",
                debitAmount: 8000,
                creditAmount: 8000,
                explanation: "Registering trademarks increases Logo and Trademarks (intangible asset, debit) and decreases Cash (asset, credit)."
            }
        ];

        // Ch3 Accounts
        const ch3Accounts = [
            "Cash", "Accounts Receivable", "Prepaid Rent", 
            "Accounts Payable", "Deferred Revenue", 
            "Revenues", "Wages Expense", "Advertising Expenses", "Utility Expenses"
        ];

        // Ch3 Transactions
        const ch3Transactions = [
            {
                id: 1,
                text: "In September, Noodlecake sold $3,000 of apps online. Cash collected in September.",
                debitAccount: "Cash",
                creditAccount: "Revenues",
                debitAmount: 3000,
                creditAmount: 3000,
                explanation: "Selling apps for cash increases Cash (asset, debit) and increases Revenues (revenue account that increases with a credit, which increases equity)."
            },
            {
                id: 2,
                text: "Noodlecake issued three $100 gift cards at the beginning of September.",
                debitAccount: "Cash",
                creditAccount: "Deferred Revenue",
                debitAmount: 300,
                creditAmount: 300,
                explanation: "Receiving cash for gift cards increases Cash (asset, debit) and creates Deferred Revenue (liability, credit) since the company has an obligation to provide goods/services in the future."
            },
            {
                id: 3,
                text: "Noodlecake sold $9,000 of apps in the App Store and on Google Play. Cash will be collected in October.",
                debitAccount: "Accounts Receivable",
                creditAccount: "Revenues",
                debitAmount: 9000,
                creditAmount: 9000,
                explanation: "Selling apps on account increases Accounts Receivable (asset, debit) and increases Revenues (revenue account that increases with a credit, which increases equity)."
            },
            {
                id: 4,
                text: "Noodlecake received checks totaling $8,500 from Apple and Google, on account.",
                debitAccount: "Cash",
                creditAccount: "Accounts Receivable",
                debitAmount: 8500,
                creditAmount: 8500,
                explanation: "Collecting cash from customers decreases Accounts Receivable (asset, credit) and increases Cash (asset, debit). This is an exchange of one asset for another."
            },
            {
                id: 5,
                text: "Noodlecake wrote checks to employees totaling $7,800 for wages related to hours worked in September.",
                debitAccount: "Wages Expense",
                creditAccount: "Cash",
                debitAmount: 7800,
                creditAmount: 7800,
                explanation: "Paying wages increases Wages Expense (expense account that increases with a debit, which decreases equity) and decreases Cash (asset, credit)."
            },
            {
                id: 6,
                text: "On September 1, Noodlecake paid $7,200 in advance for September, October, and November rent.",
                debitAccount: "Prepaid Rent",
                creditAccount: "Cash",
                debitAmount: 7200,
                creditAmount: 7200,
                explanation: "Paying rent in advance increases Prepaid Rent (asset, debit) and decreases Cash (asset, credit). This is an exchange of one asset for another."
            },
            {
                id: 7,
                text: "Noodlecake displayed online ads in September and received a bill for $500 to be paid in October.",
                debitAccount: "Advertising Expenses",
                creditAccount: "Accounts Payable",
                debitAmount: 500,
                creditAmount: 500,
                explanation: "Incurring advertising expenses increases Advertising Expenses (expense account that increases with a debit, which decreases equity) and creates an Accounts Payable obligation (liability, credit)."
            },
            {
                id: 8,
                text: "Noodlecake was notified by its bank that an automatic monthly payment of $600 was transmitted to its utility company for electricity use in September.",
                debitAccount: "Utility Expenses",
                creditAccount: "Cash",
                debitAmount: 600,
                creditAmount: 600,
                explanation: "Paying utility expenses increases Utility Expenses (expense account that increases with a debit, which decreases equity) and decreases Cash (asset, credit)."
            }
        ];

        // State
        let currentStep = 1;
        let currentQuestion = 0;
        let transactions = ch2Transactions;
        let accounts = ch2Accounts;
        let score = 0;
        let answered = [];
        let correct = [];
        let userSelections = [];

        // Selection state
        let selectedDebit = null;
        let selectedCredit = null;

        // Focus state: 'debit' or 'credit'
        let focusArea = 'debit';
        let focusedIndex = 0;  // Index within the current area

        // Initialize
        function init() {
            // Initialize state arrays based on current transactions
            answered = new Array(transactions.length).fill(false);
            correct = new Array(transactions.length).fill(false);
            userSelections = new Array(transactions.length).fill(null).map(() => ({ debit: null, credit: null }));
            
            renderSidebar();
            renderQuestion();
            updateProgress();
            updateScore();
            document.addEventListener('keydown', handleKeyDown);
        }

        function renderSidebar() {
            // Render Ch2 questions
            const ch2List = document.getElementById('ch2-questions');
            ch2List.innerHTML = '';
            ch2Transactions.forEach((t, idx) => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = '#';
                a.textContent = `Q${idx + 1}`;
                a.onclick = (e) => {
                    e.preventDefault();
                    if (currentStep === 1) {
                        currentQuestion = idx;
                        renderQuestion();
                        updateProgress();
                    } else {
                        switchStep(1);
                        setTimeout(() => {
                            currentQuestion = idx;
                            renderQuestion();
                            updateProgress();
                        }, 0);
                    }
                };
                li.appendChild(a);
                ch2List.appendChild(li);
            });

            // Render Ch3 questions
            const ch3List = document.getElementById('ch3-questions');
            ch3List.innerHTML = '';
            ch3Transactions.forEach((t, idx) => {
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = '#';
                a.textContent = `Q${idx + 1}`;
                a.onclick = (e) => {
                    e.preventDefault();
                    if (currentStep === 2) {
                        currentQuestion = idx;
                        renderQuestion();
                        updateProgress();
                    } else {
                        switchStep(2);
                        setTimeout(() => {
                            currentQuestion = idx;
                            renderQuestion();
                            updateProgress();
                        }, 0);
                    }
                };
                li.appendChild(a);
                ch3List.appendChild(li);
            });

            updateSidebar();
        }

        function updateSidebar() {
            // Update Ch2 questions
            const ch2Links = document.querySelectorAll('#ch2-questions a');
            ch2Links.forEach((link, idx) => {
                link.classList.remove('active', 'correct', 'incorrect');
                if (currentStep === 1 && currentQuestion === idx) {
                    link.classList.add('active');
                }
                if (currentStep === 1 && answered[idx]) {
                    link.classList.add(correct[idx] ? 'correct' : 'incorrect');
                }
            });

            // Update Ch3 questions
            const ch3Links = document.querySelectorAll('#ch3-questions a');
            ch3Links.forEach((link, idx) => {
                link.classList.remove('active', 'correct', 'incorrect');
                if (currentStep === 2 && currentQuestion === idx) {
                    link.classList.add('active');
                }
                if (currentStep === 2 && answered[idx]) {
                    link.classList.add(correct[idx] ? 'correct' : 'incorrect');
                }
            });
        }

        function handleKeyDown(e) {
            // ESC always clears
            if (e.key === 'Escape') {
                clearSelections();
                e.preventDefault();
                return;
            }

            // Shift + Arrow for navigation buttons
            if (e.shiftKey && e.key === 'ArrowLeft') {
                prevQuestion();
                e.preventDefault();
                return;
            }

            if (e.shiftKey && e.key === 'ArrowRight') {
                nextQuestion();
                e.preventDefault();
                return;
            }

            const numAccounts = accounts.length;

            switch (e.key) {
                case 'ArrowRight':
                    // Wrap around: debit -> credit -> debit
                    if (focusArea === 'debit') {
                        focusArea = 'credit';
                    } else {
                        focusArea = 'debit';
                    }
                    updateFocus();
                    e.preventDefault();
                    break;

                case 'ArrowLeft':
                    // Wrap around: credit -> debit -> credit
                    if (focusArea === 'credit') {
                        focusArea = 'debit';
                    } else {
                        focusArea = 'credit';
                    }
                    updateFocus();
                    e.preventDefault();
                    break;

                case 'ArrowDown':
                    // Wrap to top at bottom
                    if (focusedIndex < numAccounts - 1) {
                        focusedIndex++;
                    } else {
                        focusedIndex = 0;
                    }
                    updateFocus();
                    e.preventDefault();
                    break;

                case 'ArrowUp':
                    // Wrap to bottom at top
                    if (focusedIndex > 0) {
                        focusedIndex--;
                    } else {
                        focusedIndex = numAccounts - 1;
                    }
                    updateFocus();
                    e.preventDefault();
                    break;

                case ' ':
                    if (focusArea === 'debit') {
                        selectDebit(accounts[focusedIndex]);
                    } else if (focusArea === 'credit') {
                        selectCredit(accounts[focusedIndex]);
                    }
                    e.preventDefault();
                    break;

                case 'Enter':
                    if (answered[currentQuestion]) {
                        if (correct[currentQuestion]) {
                            // If correct, move to next question
                            nextQuestion();
                        } else {
                            // If incorrect, allow retry
                            retryQuestion();
                        }
                    } else if (selectedDebit && selectedCredit) {
                        // Submit the answer
                        checkAnswer();
                    }
                    e.preventDefault();
                    break;
            }
        }

        function updateFocus() {
            // Remove all focus
            document.querySelectorAll('.focused').forEach(el => el.classList.remove('focused'));

            if (focusArea === 'debit') {
                const btns = document.querySelectorAll('#debit-column .account-btn');
                if (btns[focusedIndex]) btns[focusedIndex].classList.add('focused');
            } else if (focusArea === 'credit') {
                const btns = document.querySelectorAll('#credit-column .account-btn');
                if (btns[focusedIndex]) btns[focusedIndex].classList.add('focused');
            }
        }

        function renderQuestion() {
            const t = transactions[currentQuestion];

            document.getElementById('question-number').textContent = `Transaction ${currentQuestion + 1}`;
            document.getElementById('transaction-text').textContent = t.text;

            // Load saved selections for this question
            selectedDebit = userSelections[currentQuestion].debit;
            selectedCredit = userSelections[currentQuestion].credit;

            // Build journal entry table
            const tbody = document.getElementById('journal-body');
            tbody.innerHTML = '';

            // Debit row
            const debitRow = document.createElement('tr');
            debitRow.className = 'debit-row';

            let debitSlotClass = 'account-slot';
            let debitText = 'Select from left...';

            if (answered[currentQuestion]) {
                const wasDebitCorrect = userSelections[currentQuestion].debit === t.debitAccount;
                debitSlotClass += wasDebitCorrect ? ' correct' : ' incorrect';
                debitText = t.debitAccount;
            } else if (selectedDebit) {
                debitSlotClass += ' filled debit-filled';
                debitText = selectedDebit;
            }

            debitRow.innerHTML = `
                <td><span class="${debitSlotClass}">${debitText}</span></td>
                <td class="amount">$${t.debitAmount.toLocaleString()}</td>
                <td class="amount"></td>
            `;
            tbody.appendChild(debitRow);

            // Credit row
            const creditRow = document.createElement('tr');
            creditRow.className = 'credit-row';

            let creditSlotClass = 'account-slot';
            let creditText = 'Select from right...';

            if (answered[currentQuestion]) {
                const wasCreditCorrect = userSelections[currentQuestion].credit === t.creditAccount;
                creditSlotClass += wasCreditCorrect ? ' correct' : ' incorrect';
                creditText = t.creditAccount;
            } else if (selectedCredit) {
                creditSlotClass += ' filled credit-filled';
                creditText = selectedCredit;
            }

            creditRow.innerHTML = `
                <td><span class="${creditSlotClass}">${creditText}</span></td>
                <td class="amount"></td>
                <td class="amount">$${t.creditAmount.toLocaleString()}</td>
            `;
            tbody.appendChild(creditRow);

            // Render account buttons
            renderAccountButtons();

            // Update button states
            document.getElementById('btn-prev').disabled = currentQuestion === 0;
            document.getElementById('btn-next').disabled = currentQuestion === transactions.length - 1;
            document.getElementById('btn-clear').disabled = answered[currentQuestion];
            document.getElementById('btn-check').disabled = answered[currentQuestion] || !selectedDebit || !selectedCredit;

            // Show/hide account panel
            document.getElementById('account-panel').style.display = answered[currentQuestion] ? 'none' : 'block';

            if (answered[currentQuestion]) {
                showFeedback(correct[currentQuestion], t.explanation);
            } else {
                hideFeedback();
            }

            // Reset focus to debit column
            if (!answered[currentQuestion]) {
                focusArea = 'debit';
                focusedIndex = 0;
            }
            updateFocus();
            updateSidebar();
        }

        function renderAccountButtons() {
            const debitColumn = document.getElementById('debit-column');
            const creditColumn = document.getElementById('credit-column');

            // Clear existing buttons (keep headers)
            debitColumn.innerHTML = '<div class="column-header debit">On debit side:</div>';
            creditColumn.innerHTML = '<div class="column-header credit">On credit side:</div>';

            accounts.forEach((account, idx) => {
                // Debit button
                const debitBtn = document.createElement('button');
                debitBtn.className = 'account-btn';
                debitBtn.textContent = account;
                if (account === selectedDebit) {
                    debitBtn.classList.add('debit-selected');
                }
                debitBtn.onclick = () => {
                    focusArea = 'debit';
                    focusedIndex = idx;
                    selectDebit(account);
                };
                debitColumn.appendChild(debitBtn);

                // Credit button
                const creditBtn = document.createElement('button');
                creditBtn.className = 'account-btn';
                creditBtn.textContent = account;
                if (account === selectedCredit) {
                    creditBtn.classList.add('credit-selected');
                }
                creditBtn.onclick = () => {
                    focusArea = 'credit';
                    focusedIndex = idx;
                    selectCredit(account);
                };
                creditColumn.appendChild(creditBtn);
            });
        }

        function selectDebit(account) {
            if (answered[currentQuestion]) return;

            if (selectedDebit === account) {
                selectedDebit = null;
            } else {
                selectedDebit = account;
            }
            userSelections[currentQuestion].debit = selectedDebit;
            renderQuestion();
        }

        function selectCredit(account) {
            if (answered[currentQuestion]) return;

            if (selectedCredit === account) {
                selectedCredit = null;
            } else {
                selectedCredit = account;
            }
            userSelections[currentQuestion].credit = selectedCredit;
            renderQuestion();
        }

        function clearSelections() {
            if (answered[currentQuestion]) return;
            selectedDebit = null;
            selectedCredit = null;
            userSelections[currentQuestion] = { debit: null, credit: null };
            focusArea = 'debit';
            focusedIndex = 0;
            renderQuestion();
        }

        function retryQuestion() {
            // Allow retry for incorrect answers
            answered[currentQuestion] = false;
            correct[currentQuestion] = false;
            selectedDebit = null;
            selectedCredit = null;
            userSelections[currentQuestion] = { debit: null, credit: null };
            focusArea = 'debit';
            focusedIndex = 0;
            renderQuestion();
            updateProgress();
            updateSidebar();
        }

        function checkAnswer() {
            if (answered[currentQuestion]) return;
            if (!selectedDebit || !selectedCredit) return;

            const t = transactions[currentQuestion];

            const debitCorrect = selectedDebit === t.debitAccount;
            const creditCorrect = selectedCredit === t.creditAccount;
            const allCorrect = debitCorrect && creditCorrect;

            answered[currentQuestion] = true;
            correct[currentQuestion] = allCorrect;

            if (allCorrect) {
                score++;
                updateScore();
            }

            renderQuestion();
            updateProgress();
            updateSidebar();
        }

        function showFeedback(isCorrect, explanation) {
            const feedback = document.getElementById('feedback');
            const title = document.getElementById('feedback-title');
            const text = document.getElementById('feedback-text');

            feedback.className = `feedback show ${isCorrect ? 'correct' : 'incorrect'}`;
            title.textContent = isCorrect ? '✓ Correct!' : '✗ Not quite right';
            text.textContent = explanation;
        }

        function hideFeedback() {
            document.getElementById('feedback').className = 'feedback';
        }

        function nextQuestion() {
            if (currentQuestion < transactions.length - 1) {
                currentQuestion++;
                renderQuestion();
                updateProgress();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
                updateProgress();
            }
        }

        function updateProgress() {
            const answeredCount = answered.filter(a => a).length;
            const total = transactions.length;
            const percent = (answeredCount / total) * 100;

            document.getElementById('progress-bar').style.width = `${percent}%`;
            document.getElementById('progress-text').textContent = `Question ${currentQuestion + 1} of ${total}`;
            document.getElementById('total').textContent = total;
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
        }

        function switchStep(step) {
            currentStep = step;
            currentQuestion = 0;
            score = 0;
            
            if (step === 1) {
                transactions = ch2Transactions;
                accounts = ch2Accounts;
                document.getElementById('chapter-label').textContent = 'Journal entries required in August';
            } else if (step === 2) {
                transactions = ch3Transactions;
                accounts = ch3Accounts;
                document.getElementById('chapter-label').textContent = 'Journal entries required in September';
            }
            
            // Reset state arrays
            answered = new Array(transactions.length).fill(false);
            correct = new Array(transactions.length).fill(false);
            userSelections = new Array(transactions.length).fill(null).map(() => ({ debit: null, credit: null }));
            
            // Update step buttons
            document.querySelectorAll('.step-btn').forEach((btn, idx) => {
                if (idx + 1 === step) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Reset selections
            selectedDebit = null;
            selectedCredit = null;
            focusArea = 'debit';
            focusedIndex = 0;
            
            renderSidebar();
            renderQuestion();
            updateProgress();
            updateScore();
        }

        // Start
        init();
    </script>
    </div>
</body>
</html>
